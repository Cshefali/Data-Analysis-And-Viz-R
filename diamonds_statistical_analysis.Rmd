---
title: "Statistical Analysis of diamonds dataset"
author: "Shefali C."
date: "2024-02-05"
output: 
      prettydoc::html_pretty:
        theme: cayman
        highlight: vignette
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This notebook includes methods to visualize data distribution using ggplot2. I've used the built-in dataset **`diamonds`** for demonstration.  
Following plots and their customization are included in this notebook:  
1. Histograms  
2. Density Plots  
3. Boxplots  

Other statistical measurements like mean, median, mode, standard deviation, variance have also been plotted towards the end of this notebook.  

So, all in all, I've taken the example of **`diamonds`** to show how a dataset is statistically analysed in initial phases of analysis.  

## Notebook Contents in a nutshell:

```{r load-libraries, message=FALSE, warning=FALSE}
#load libraries

library(tidyverse)
#textGrob() of grid package has been used.
library(grid)
library(plyr)
library(hrbrthemes)
library(knitr)
library(kableExtra)
library(showtext)
``` 

```{r}
library(ggcorrplot)
```


```{r}
font_add_google(family = "Roboto Mono", "Roboto Mono")
showtext::showtext_auto()
```




```{r read-data}
#read data
df1 <- diamonds
#a quick look at the dataset
glimpse(df1)
```

# Table:

```{r table-view, results='asis'}

kable(slice_sample(df1,n = 5), caption = "Quick glimpse of diamonds df",
      booktabs = T) %>% 
  kableExtra::kable_styling(font_size = 10)
```

## Data description  


### Variables: 

- **`carat`-** weight of diamond (0.2 - 5.01)  
- **`price`-** price in USD (\$326-\$18,823)  
- **`cut`-** quality of the diamond cut (Fair, Good, Very good, Premium, Ideal).  
- **`color`-** dimaond color from D (best) to J (worst)  
- **`table`-** width of top of the diamond relative to the widest point.  
- **`x`-** length in mm (0 - 10.74)  
- **`y`-** width in mm (0 - 58.9)  
- **`z`-** depth in mm (0 - 31.8)  


## Data Distribution Viz 

### 1. Histograms

#### a) Simple Histogram

```{r}
(p1 <- ggplot(data = df1, aes(x=carat))+
        geom_histogram(breaks = seq(0,5.2,0.2), fill = "lightblue",
                       color = "black", alpha = 0.5)+
        scale_x_continuous(breaks = seq(0,5.2,0.2),
                           labels = seq(0, 5.2, 0.2))+
        scale_y_continuous(expand = c(0,0), limits = c(0,15000),
                           breaks = seq(0,15000,3000),
                           labels = paste0(seq(0,15000,3000)/1000))+
        labs(title = "Distribution of diamond carat",
             caption = "Source: RStudio built-in dataset")+
        theme_bw()+
        theme(axis.text = element_text(size = 5, face = "bold", color = "black"),
              plot.caption = element_text(face = "bold.italic", size = 6,hjust = 0))
)
```

#### b) Histogram with a mean line

```{r}
carat_mean <- mean(df1$carat)
carat_median <- median(df1$carat)
```

```{r}
#text grobs to place on plot below
mean_label <- grid::textGrob(label = "mean",
                            rot = 90, y = 0.80,
                            gp = gpar(fontsize = 7,
                                      fontface = "bold",
                                      col = "red"))
#median
median_label <- grid::textGrob(label = "median",
                               rot = 90,y=0.80,
                               gp = gpar(fontface = "bold",
                                         fontsize = 7,
                                         col = "darkblue"))
```



```{r}
p1 +
  geom_vline(aes(xintercept = mean(carat)), color = "red",
             linetype = "dashed", linewidth = 0.7)+
  annotation_custom(mean_label, xmin = carat_mean+0.05, xmax = carat_mean+0.05)+
  # annotate(geom = "text", label = "mean", color = "red",
  #          size = 3, fontface = "bold", x = carat_mean+0.03,
  #          y = 12, angle = 90)+
  geom_vline(aes(xintercept = median(carat)), color = "darkblue",
             linetype = "dashed", linewidth = 0.7)+
  annotation_custom(median_label, xmin = carat_median-0.1,
                    xmax = carat_median-0.1)+
  coord_cartesian(clip = "off")
```




#### c) Histogram with a density plot

```{r}
df1 %>% 
  ggplot(aes(x=carat))+
  geom_histogram(aes(y = after_stat(density)),
        breaks = seq(0,5.2,0.2), fill = "white",
        color = "black")+
  geom_density(color = "black", fill = "blue",
               alpha = 0.3, linewidth = 0.4)+
        scale_x_continuous(breaks = seq(0,5.2,0.2),
                           labels = seq(0, 5.2, 0.2))+
        scale_y_continuous(expand = c(0,0))+
        labs(title = "Distribution of diamond carat",
             caption = "Source: RStudio built-in dataset")+
        theme_bw()+
        theme(axis.text = element_text(size = 5, face = "bold", color = "black"),
              plot.caption = element_text(face = "bold.italic", size = 6,hjust = 0))
```


#### d) Histogram- coloring based on groups (Interleaved hist)

There are 5 unique values in **"cut"** feature namely fair, good, very good, premium & ideal.  
Each of the groups will get a distinct color.  

```{r}
df1 %>% 
  ggplot(aes(x=carat))+
  geom_histogram(aes(fill = cut),
        breaks = seq(0,5.2,0.2))+
        scale_x_continuous(breaks = seq(0,5.2,0.2),
                           labels = seq(0, 5.2, 0.2))+
        scale_y_continuous(expand = c(0,0))+
  facet_wrap(~cut, scales = "free")+
        labs(title = "Distribution of diamond carat",
             caption = "Source: RStudio built-in dataset")+
  theme_bw()+
  theme(axis.text = element_text(size = 4, face = "bold"),
        plot.caption = element_text(hjust = 0))
```




### 2. Density Plots

```{r}
df1 %>% 
  ggplot(aes(x=carat, fill = cut))+
  geom_density(outline.type = "full", linewidth=0.4)+
  scale_y_continuous(expand = c(0,0))+
  labs(title = "Carat distribution of diamonds",
       caption = "Source: R built-in dataset")+
  theme_bw()+
  theme(plot.caption = element_text(hjust=0, size = 7, color = "black",
                                    face = "italic"),
        axis.title = element_text(size = 7, color = "black"),
        axis.text = element_text(size = 6, color = "black"),
        legend.text = element_text(size = 6))

```


### 3. Frequency Polygon Charts (geom_freqpoly()) 
```{r}
df1 %>% 
  ggplot(aes(x=carat,fill = cut))+
  geom_density(position = "stack", linewidth=0.3)+
  theme_bw()+
  scale_y_continuous(expand = c(0,0))
```


### 4. Box Plots

```{r}
df1 %>% 
  ggplot(aes(x=cut))+
  geom_boxplot(aes(fill = cut))+
  facet_wrap(~cut, scales="free")+
  theme_bw()
```


### 5. Rug Plot

### 6. Violin Plot (Box Plot + KDE plot)

### 7. How to place groups in desired sequence in a stacked bar chart?


```{r}
#standard deviation of carat
sd(diamonds$carat)
```

```{r}
glimpse(diamonds)
```
## Reference for Correlation plot:

[ggcorrplot](https://rpkgs.datanovia.com/ggcorrplot/)

```{r}
#variance
cor(diamonds$z, diamonds$price)
```

#### Correlation plot

```{r}
#subset of diamonds dataset
diamonds_subset <- diamonds %>% select(carat, depth, table, x, y, z, price)
#find correlation between all numeric variables
corr <- round(cor(diamonds_subset),2)
#a matrix of correlation p values
corr_p <- cor_pmat(diamonds_subset)
```

```{r}
#corr plot
ggcorrplot(corr,
           ggtheme = ggplot2::theme_minimal,
           colors = c("steelblue","white","#ffa600"),
           lab = T,
           insig = "blank")
```

### Boxplot

```{r}
df1 %>% 
  ggplot(aes(x=carat))+
  geom_boxplot()+
  labs(title = "IQR for carat of diamonds")+
  theme_bw()
```

```{r}
df1 %>% 
  ggplot(aes(x=price))+
  geom_boxplot()+
  labs(title = "IQR for price of diamonds")+
  theme_bw()
```



















